<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" /><link rel="canonical" href="https://ibm-mas-manage.github.io/sno/" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Single Node OpenShift</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Single Node OpenShift";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = "/sno/";
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> Single Node OpenShift
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">Single Node OpenShift</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installing-openshift-container-platform-in-a-single-node-openshift">Installing OpenShift Container Platform in a single Node OpenShift</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#install-openshift-platform-cluster-on-a-single-node">Install OpenShift Platform Cluster on a Single Node</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#aws">AWS</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#bare-metal-and-vsphere">Bare Metal and vSphere</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-mas-and-dependencies">Install MAS and dependencies</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#oc-login">OC Login:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#intall-db2-optional">Intall DB2 (optional)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-and-configure-manage">Install and Configure Manage</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">Single Node OpenShift</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Single Node OpenShift</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas-manage/sno/blob/master/docs/index.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="single-node-openshift-openshift-410">Single Node OpenShift (OpenShift 4.10+)<a class="headerlink" href="#single-node-openshift-openshift-410" title="Permanent link"></a></h1>
<p><strong>MAS 8.9/Manage 8.5</strong></p>
<p>A single node offers both control and worker node functionality, users who have adopted Kubernetes at their central management sites and who wish to have independent Kubernetes clusters at edge sites can deploy this smaller OpenShift footprint and have minimal to no dependence on the centralized management cluster and can run autonomously when needed. This page documents how to setup MAS Manage on a SNO cluster.</p>
<p>A single node OpenShift deployment differs from the default self-managed/highly-available cluster profile in couple of ways:</p>
<ul>
<li>
<p>To optimize system resource usage, many operators are configured to reduce the footprint of their operands when running on a single node OpenShift.</p>
</li>
<li>
<p>In environments that require high availability, it is recommended that the architecture be configured in a way in which if the hardware was to fail, those workloads are transitioned to other sites or nodes while the impacted node is recovered. </p>
</li>
</ul>
<h2 id="installing-openshift-container-platform-in-a-single-node-openshift">Installing OpenShift Container Platform in a single Node OpenShift<a class="headerlink" href="#installing-openshift-container-platform-in-a-single-node-openshift" title="Permanent link"></a></h2>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link"></a></h3>
<ul>
<li>vCPU: 16Cores</li>
<li>RAM: 64Gb</li>
<li>IBM entitlement Key : Log in to the IBM Container Library with a user ID that has software download rights for your company’s Passport Advantage entitlement. Your entitlement key should be displayed on that page
openshift pull secret file (pull-secret). It can be downloaded from [here] (https://access.redhat.com/management). You need a valid redhat account for downloading.</li>
<li>Openshift pull secret file (pull-secret). It can be downloaded from [here] (https://access.redhat.com/management). You need a valid redhat account for downloading.</li>
<li>MAS license file (license.dat): Access IBM License Key Center, on the Get Keys menu select IBM AppPoint Suites. Select IBM MAXIMO APPLICATION SUITE AppPOINT LIC.  more details can be found in [here] (https://ibm-mas.github.io/ansible-devops/playbooks/oneclick-core/#2-mas-license-file)</li>
<li>Docker/Podman   </li>
<li>AWS<ul>
<li>Valid AWS access key id </li>
<li>Secret access key: If you don't it, ask your aws account admin to create one in IAM service</li>
<li>Domain or subdomain: If you don't have one, ask your aws account admin to register one through AWS Route53</li>
</ul>
</li>
<li>Bare metal/vSphere: <ul>
<li>[Requirements] (https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/installing/installing-on-a-single-node#install-sno-requirements-for-installing-on-a-single-node_install-sno-preparing)</li>
</ul>
</li>
</ul>
<h3 id="install-openshift-platform-cluster-on-a-single-node">Install OpenShift Platform Cluster on a Single Node<a class="headerlink" href="#install-openshift-platform-cluster-on-a-single-node" title="Permanent link"></a></h3>
<ul>
<li>Set up IBM MAS DevOps ansible collection docker container</li>
</ul>
<pre><code>mkdir ~/sno
cd ~/sno
git clone https://github.com/ibm-mas/ansible-devops
docker run -dit -v ~/sno:/opt/app-root/src/sno --name sno quay.io/ibmmas/ansible-devops:latest bash​
docker exec -it sno bash
cd /opt/app-root/src/sno/ansible-devops/ibm/mas_devops
./rebuild.sh
exit
</code></pre>
<ul>
<li>Log into the docker container; create a folder for mas configuration; then exit the container</li>
</ul>
<pre><code>docker exec -it sno bash
mkdir /root/masconfig
exit
</code></pre>
<ul>
<li>Copy pull-secret and mas license file into the docker container</li>
</ul>
<pre><code>docker cp pull-secret sno:/root/masconfig/pull-secret
docker cp license.dat sno:/root/masconfig/license.dat
</code></pre>
<h4 id="aws">AWS<a class="headerlink" href="#aws" title="Permanent link"></a></h4>
<ul>
<li>Log into docker container, set env variables, then run playbook to provision SNO Cluster</li>
</ul>
<pre><code>docker exec -it sno bash

export AWS_ACCESS_KEY_ID=&quot;&lt;your aws access key id&quot;
export AWS_SECRET_ACCESS_KEY=&quot;&lt;your aws secret access key&quot;
export IPI_PLATFORM=aws
export CLUSTER_TYPE=&quot;ipi&quot;
export CLUSTER_NAME=&lt;cluster name e.g. sno&gt;
export IPI_REGION=&lt;aws region e.g. us-east-1?
export IPI_BASE_DOMAIN=&lt;your domain&gt;
export IPI_PULL_SECRET_FILE=&quot;/root/masconfig/pull-secret&quot;
export IPI_DIR=&quot;/root/sno&quot;
export IPI_CONTROLPLANE_REPLICAS=1
export IPI_COMPUTE_REPLICAS=0
export OCP_VERSION=&quot;latest-4.10&quot;

ansible-playbook ibm.mas_devops.ocp_aws_provision

</code></pre>
<h4 id="bare-metal-and-vsphere">Bare Metal and vSphere<a class="headerlink" href="#bare-metal-and-vsphere" title="Permanent link"></a></h4>
<ul>
<li>
<p>[Installation Instructions] (https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/installing/installing-on-a-single-node)</p>
</li>
<li>
<p>Ensure that your registry is set to managed to enable building and pushing of images.</p>
</li>
<li>
<p>Run</p>
<p><code>$ oc edit configs.imageregistry/cluster</code></p>
</li>
<li>
<p>Then, change the line</p>
<p><code>managementState: Removed</code>
to</p>
<p><code>managementState: Managed</code></p>
</li>
<li>
<p>Here is the link for [configuring the registry for bare metal] (https://docs.openshift.com/container-platform/4.8/registry/configuring_registry_storage/configuring-registry-storage-baremetal.html#configuring-registry-storage-baremetal)</p>
</li>
<li>
<p>Storage class : Local storage in Kubernetes means storage devices or filesystems available locally on a node server. Install [LVM-Operator]] (https://github.com/red-hat-storage/lvm-operator)</p>
</li>
</ul>
<p>You can install LVM operator from operator hub.</p>
<p>ToDo add Screen Shots</p>
<h2 id="install-mas-and-dependencies">Install MAS and dependencies<a class="headerlink" href="#install-mas-and-dependencies" title="Permanent link"></a></h2>
<h3 id="oc-login">OC Login:<a class="headerlink" href="#oc-login" title="Permanent link"></a></h3>
<pre><code>oc login --token=xxxx --server=&lt;https://myocpserver&gt;
</code></pre>
<p>Replace <code>xxxx</code> with your OpenShift token and <code>https://myocpserver</code> with your OpenShift Server.
You can get OC Login information from OpenShift Console (top right corner <code>kube:admin</code> drop down list, select <code>Copy login command</code>)</p>
<pre><code>export MONGODB_STORAGE_CLASS=&lt;storage-class&gt;
export IBM_ENTITLEMENT_KEY=&lt;entitlement-key&gt;
export MAS_APP_ID=manage
export SLS_ENTITLEMENT_KEY=&lt;entitlement-key&gt;
export SLS_STORAGE_CLASS=&lt;storage-class&gt;
export SLS_LICENSE_ID=&lt;license-id&gt;
export SLS_LICENSE_FILE=&lt;license-file&gt;
export UDS_STORAGE_CLASS=&lt;storage-class&gt;
export UDS_CONTACT_EMAIL=&lt;your email-id&gt;
export UDS_CONTACT_FIRSTNAME=&lt;your first name&gt;
export UDS_CONTACT_LASTNAME=&lt;your first name&gt;
export MAS_INSTANCE_ID=&lt;instance-id&gt;
export MAS_CONFIG_DIR=&lt;config-dir&gt;
export MAS_WORKSPACE_ID=&lt;mas-workspace-id&gt;
export MAS_ENTITLEMENT_KEY=&lt;entitlement-key&gt;
export PROMETHEUS_STORAGE_CLASS=&lt;storage-class&gt;
export PROMETHEUS_ALERTMGR_STORAGE_CLASS=&lt;storage-class&gt;
export GRAFANA_INSTANCE_STORAGE_CLASS=&lt;storage-class&gt;
export MONGODB_REPLICAS=1
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>How to get the <code>IBM Entitlement key</code> and <code>SLS License file</code> check <a href="https://ibm-mas.github.io/ansible-devops/playbooks/oneclick-core/#preparation">preparation link</a></p>
</div>
<p>Sample environment variables:</p>
<pre><code>export MONGODB_STORAGE_CLASS=gp2 
export MAS_APP_ID=manage
export SLS_STORAGE_CLASS=gp2
export SLS_LICENSE_ID=0242ac110002 
export SLS_LICENSE_FILE=~/masconfig/entitlement.lic
export UDS_STORAGE_CLASS=gp2
export UDS_CONTACT_EMAIL=abc@us.ibm.com
export UDS_CONTACT_FIRSTNAME=abc
export UDS_CONTACT_LASTNAME=abc
export MAS_INSTANCE_ID=sno
export MAS_CONFIG_DIR=~/masconfig
export MAS_WORKSPACE_ID=masdev
export MAS_INSTANCE_ID=sno
export PROMETHEUS_STORAGE_CLASS=gp2
export PROMETHEUS_ALERTMGR_STORAGE_CLASS=go2
export GRAFANA_INSTANCE_STORAGE_CLASS=gp2
export MONGODB_REPLICAS=1
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>gp2</code> is the default storage class in AWS. You can optionally install RedHat LVM (Logical Volume Manager) operator using OperatorHub for volume management.</p>
</div>
<ul>
<li>Run ansible playbook to install MAS core and dependencies. It takes about 1.5 hours to complete the installation. Some tasks takes more time to complete and you will see <code>Failed - Retrying...</code> messages.</li>
</ul>
<pre><code>ansible-playbook playbooks/oneclick_core.yml
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Check out <a href="https://ibm-mas.github.io/ansible-devops/">MAS Ansible Devops Documentation</a> for more information</p>
</div>
<h2 id="intall-db2-optional">Intall DB2 (optional)<a class="headerlink" href="#intall-db2-optional" title="Permanent link"></a></h2>
<p>Install DB2 using this <a href="https://ibm-mas.github.io/ansible-devops/roles/db2/">Db2 link</a></p>
<p>Sample environment variables:</p>
<pre><code>export DB2_BACKUP_STORAGE_ACCESSMODE=READWRITEONCE
export DB2_META_STORAGE_ACCESSMODE=READWRITEONCE
export DB2_META_STORAGE_CLASS=gp2
export DB2_DATA_STORAGE_CLASS=gp2
export DB2_BACKUP_STORAGE_CLASS=gp2
export DB2_LOGS_STORAGE_CLASS=gp2
export DB2_TEMP_STORAGE_CLASS=gp2

export DB2_META_STORAGE_SIZE=10Gi  
export DB2_BACKUP_STORAGE_SIZE=10Gi  
export DB2_LOGS_STORAGESIZE=10Gi 
export DB2_TEMP_STORAGE_SIZE=10Gi
export DB2_DATA_STORAGE_SIZE=20Gi
export DB2_CPU_REQUESTS=300m
export DB2_CPU_LIMITS=2000m

</code></pre>
<h2 id="install-and-configure-manage">Install and Configure Manage<a class="headerlink" href="#install-and-configure-manage" title="Permanent link"></a></h2>
<ul>
<li>You can run the following automation playbook to install DB2 and Manage. </li>
</ul>
<pre><code>ansible-playbook playbooks/oneclick_add_manage.yml
</code></pre>
<ul>
<li>
<p>If you want to use an existing external database, install the Manage app and configure the database using the following steps (MAS admin dashboard):</p>
<ul>
<li>
<p>Go to MAS admin UI.</p>
<ul>
<li>From OpenShift Console, go to Routes. Select Admin dashboard. Click on Locations to go MAS admin dashboard.</li>
</ul>
<p><img alt="image" src="images/route.png" /></p>
<ul>
<li>
<p>Make sure you can connect to coreapi service route.</p>
</li>
<li>
<p>Get the superuser password from <code>mas-sno-core</code> project secrets to log in to the MAS admin dashboard.</p>
</li>
</ul>
<p><img alt="image" src="images/superuser.png" /></p>
<ul>
<li>Create an authorized admin user using <code>Users</code> page. For example, masadmin</li>
</ul>
<p><img alt="image" src="images/createuser.png" /></p>
<ul>
<li>Login as admin user <code>masadmin</code> created in the previous step. Install Manage from the catalog page.</li>
</ul>
<p><img alt="image" src="images/installmanage.png" /></p>
<ul>
<li>Select <code>Application version</code> action to deploy operator.</li>
</ul>
<p><img alt="image" src="images/applicationversion.png" /></p>
<ul>
<li>Select subscription </li>
</ul>
<p><img alt="image" src="images/subscription.png" /></p>
<ul>
<li>After deployment is complete, select <code>Update configuration</code> by selecting the action from the top right corner of the page:</li>
</ul>
<p><img alt="image" src="images/configurationnew.png" /></p>
<ul>
<li>Update database connection:</li>
</ul>
<p><img alt="image" src="images/dbconnection.png" /></p>
<ul>
<li>Update database configuration. Select <code>Install Demo Data</code> if want to add maxdemo data.</li>
</ul>
<p><img alt="image" src="images/dbconfig.png" /></p>
<ul>
<li>
<p>Apply changes by clicking on the blue <code>Activate</code> button in the top right.</p>
</li>
<li>
<p>After successful activation, the <code>Manage</code> app can be accessed by clicking on the nine-dot menu in the top right corner.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas-manage/sno" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.4.2
Build Date UTC : 2022-11-14 05:51:46.315724+00:00
-->
